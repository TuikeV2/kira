import{j as e}from"./vendor-motion-DD2yjgze.js";import{e as pe,r}from"./vendor-react-Chdf233T.js";import{aR as he,v as Q,u as ue,b as ye,G as be,bo as x,W as je,av as q,ae as ke,J as fe,aj as B,bt as Ne,x as we,bn as ve,aa as Ue,E as Se,N as ze,M as Ce}from"./index-Cwht9-s6.js";import{S as F}from"./StatCard-BNGy35B2.js";import{M as $}from"./Modal-BPkZiGXf.js";import{P as De}from"./Pagination-ByhZH2CY.js";import"./vendor-utils-BpAiQRgT.js";import"./vendor-icons-DwoABqcb.js";const H={danger:{icon:Q,iconBg:"bg-red-100 dark:bg-red-900/30",iconColor:"text-red-600 dark:text-red-400",confirmBtn:"btn-danger",confirmText:"Usun"},warning:{icon:Q,iconBg:"bg-yellow-100 dark:bg-yellow-900/30",iconColor:"text-yellow-600 dark:text-yellow-400",confirmBtn:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium transition-colors",confirmText:"Kontynuuj"},info:{icon:he,iconBg:"bg-blue-100 dark:bg-blue-900/30",iconColor:"text-blue-600 dark:text-blue-400",confirmBtn:"btn-primary",confirmText:"Potwierdz"}};function Ie({isOpen:m,onConfirm:a,onCancel:n,title:g,message:z,variant:i="info",confirmText:C,cancelText:D="Anuluj",loading:p=!1}){const c=H[i]||H.info,h=c.icon;return e.jsx($,{isOpen:m,onClose:n,size:"sm",showCloseButton:!1,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`mx-auto w-16 h-16 rounded-full ${c.iconBg} flex items-center justify-center mb-4`,children:e.jsx(h,{className:`w-8 h-8 ${c.iconColor}`})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:g}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:z}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:n,disabled:p,className:"btn-secondary",children:D}),e.jsx("button",{onClick:a,disabled:p,className:c.confirmBtn,children:p?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Przetwarzanie..."]}):C||c.confirmText})]})]})})}function Re(){var G,J;const{user:m}=ue(),{t:a}=ye();pe();const n=be(),[g,z]=r.useState([]),[i,C]=r.useState(null),[D,p]=r.useState(!0),[c,h]=r.useState(1),[X,Y]=r.useState(1),[ee,se]=r.useState(0),[j,ae]=r.useState(""),[k,te]=r.useState(""),[f,re]=r.useState("created_at"),[N,P]=r.useState("DESC"),[I,E]=r.useState(null),[M,R]=r.useState(!1),[o,T]=r.useState(null),[b,A]=r.useState(null),[ne,O]=r.useState(!1),[l,u]=r.useState([]),[Z,w]=r.useState(!1),[W,v]=r.useState(""),[U,S]=r.useState(!1),_=10,y=r.useCallback(async()=>{try{p(!0);const s={page:c,limit:_,sort:f,order:N};j&&(s.search=j),k&&(s.role=k);const t=await x.getUsers(s);z(t.data.data),Y(t.data.pagination.totalPages),se(t.data.pagination.total)}catch{n.error(a("common.fetchError")||"Failed to load users")}finally{p(!1)}},[c,j,k,f,N]),L=async()=>{try{const s=await x.getUserStats();C(s.data.data)}catch{n.error(a("common.fetchError")||"Failed to load stats")}};r.useEffect(()=>{y()},[y]),r.useEffect(()=>{L()},[]);const le=s=>{ae(s.target.value),h(1)},V=s=>{f===s?P(N==="DESC"?"ASC":"DESC"):(re(s),P("DESC")),h(1)},oe=async s=>{E(s),R(!0),O(!0);try{const t=await x.getUserDetails(s.id);T(t.data.data)}catch{n.error(a("common.fetchError")||"Failed to load user details")}finally{O(!1)}},de=async s=>{const t=s.role==="ADMIN"?"USER":"ADMIN";try{await x.updateUserRole(s.id,t),n.success(a("adminUsers.roleUpdated")||`Rola zmieniona na ${t}`),y(),L()}catch{n.error(a("adminUsers.roleUpdateFailed")||"Nie udalo sie zmienic roli")}},ie=async()=>{var s,t;if(b)try{await x.deleteUser(b.id),n.success(a("adminUsers.userDeleted")||"Uzytkownik usuniety"),A(null),y(),L()}catch(d){n.error(((t=(s=d.response)==null?void 0:s.data)==null?void 0:t.message)||a("adminUsers.deleteFailed")||"Nie udalo sie usunac")}},ce=s=>{u(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},xe=()=>{const s=g.filter(t=>t.discordId!==m.discordId);l.length===s.length?u([]):u(s.map(t=>t.id))},me=async()=>{var s,t;if(l.length!==0){S(!0);try{await x.banUsers(l,W||null),n.success(`Zbanowano ${l.length} uzytkownikow`),w(!1),v(""),u([]),y()}catch(d){n.error(((t=(s=d.response)==null?void 0:s.data)==null?void 0:t.message)||"Nie udalo sie zbanowac uzytkownikow")}finally{S(!1)}}},ge=async()=>{var s,t;if(l.length!==0){S(!0);try{await x.unbanUsers(l),n.success(`Odbanowano ${l.length} uzytkownikow`),u([]),y()}catch(d){n.error(((t=(s=d.response)==null?void 0:s.data)==null?void 0:t.message)||"Nie udalo sie odbanowac uzytkownikow")}finally{S(!1)}}},K=({col:s})=>f!==s?null:N==="DESC"?e.jsx(ze,{className:"w-3 h-3"}):e.jsx(Ce,{className:"w-3 h-3"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:a("adminUsers.title")||"Zarzadzanie uzytkownikami"}),e.jsx("p",{className:"page-subtitle",children:a("adminUsers.subtitle")||"Przegladaj i zarzadzaj uzytkownikami systemu"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(F,{title:a("adminUsers.totalUsers")||"Wszystkich uzytkownikow",value:(i==null?void 0:i.totalUsers)||0,icon:je,color:"blue"}),e.jsx(F,{title:a("adminUsers.admins")||"Administratorzy",value:(i==null?void 0:i.adminCount)||0,icon:q,color:"purple"}),e.jsx(F,{title:a("adminUsers.newThisMonth")||"Nowi w tym miesiacu",value:(i==null?void 0:i.newUsersThisMonth)||0,icon:ke,color:"green"})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:a("adminUsers.searchPlaceholder")||"Szukaj po nazwie, Discord ID lub email...",value:j,onChange:le,className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("select",{value:k,onChange:s=>{te(s.target.value),h(1)},className:"px-4 py-2.5 bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:a("adminUsers.allRoles")||"Wszystkie role"}),e.jsx("option",{value:"ADMIN",children:"Admin"}),e.jsx("option",{value:"USER",children:"User"})]})]}),l.length>0&&e.jsxs("div",{className:"flex items-center gap-3 mt-3 pt-3 border-t border-gray-200 dark:border-dark-600",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Wybrano: ",e.jsx("strong",{children:l.length})]}),e.jsxs("button",{onClick:()=>w(!0),disabled:U,className:"flex items-center gap-2 px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(B,{className:"w-3.5 h-3.5"}),"Zbanuj"]}),e.jsxs("button",{onClick:ge,disabled:U,className:"flex items-center gap-2 px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),"Odbanuj"]}),e.jsx("button",{onClick:()=>u([]),className:"px-3 py-1.5 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm transition-colors",children:"Wyczysc"})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800/50",children:[e.jsx("th",{className:"w-10 px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:l.length>0&&l.length===g.filter(s=>s.discordId!==m.discordId).length,onChange:xe,className:"w-4 h-4 rounded border-gray-300 dark:border-dark-600 text-primary-500 focus:ring-primary-500"})}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("adminUsers.user")||"Uzytkownik"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:"Discord ID"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("adminUsers.role")||"Rola"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none",onClick:()=>V("last_login"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[a("adminUsers.lastLogin")||"Ostatnie logowanie",e.jsx(K,{col:"last_login"})]})}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("adminUsers.licenses")||"Licencje"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase cursor-pointer hover:text-gray-700 dark:hover:text-gray-200 select-none",onClick:()=>V("created_at"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[a("adminUsers.createdAt")||"Utworzony",e.jsx(K,{col:"created_at"})]})}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase",children:a("adminUsers.actions")||"Akcje"})]})}),e.jsx("tbody",{children:D?Array.from({length:5}).map((s,t)=>e.jsx("tr",{className:"border-b border-gray-100 dark:border-dark-700/50",children:e.jsx("td",{colSpan:8,className:"px-4 py-4",children:e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-dark-700 rounded animate-pulse"})})},t)):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-12 text-center text-gray-400 dark:text-gray-500",children:a("adminUsers.noUsers")||"Nie znaleziono uzytkownikow"})}):g.map(s=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-dark-700/50 hover:bg-gray-50 dark:hover:bg-dark-800/30 transition-colors ${s.isBanned?"bg-red-50 dark:bg-red-900/10":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:s.discordId!==m.discordId&&e.jsx("input",{type:"checkbox",checked:l.includes(s.id),onChange:()=>ce(s.id),className:"w-4 h-4 rounded border-gray-300 dark:border-dark-600 text-primary-500 focus:ring-primary-500"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.avatar?`https://cdn.discordapp.com/avatars/${s.discordId}/${s.avatar}.png?size=32`:"https://cdn.discordapp.com/embed/avatars/0.png",alt:"",className:`w-8 h-8 rounded-full ${s.isBanned?"opacity-50":""}`}),s.isBanned&&e.jsx(B,{className:"absolute -top-1 -right-1 w-4 h-4 text-red-500"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`text-sm font-medium ${s.isBanned?"text-gray-400 dark:text-gray-500 line-through":"text-gray-800 dark:text-gray-200"}`,children:s.username||"Unknown"}),s.isBanned&&s.banReason&&e.jsx("p",{className:"text-xs text-red-500 truncate max-w-[150px]",title:s.banReason,children:s.banReason})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-xs font-mono text-gray-500 dark:text-gray-400",children:s.discordId})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold ${s.role==="ADMIN"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-gray-100 dark:bg-dark-600 text-gray-700 dark:text-gray-300"}`,children:[s.role==="ADMIN"?e.jsx(we,{className:"w-3 h-3"}):e.jsx(ve,{className:"w-3 h-3"}),s.role]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString("pl-PL"):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:s.licensesCount||0})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:new Date(s.createdAt).toLocaleDateString("pl-PL")}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>oe(s),className:"p-1.5 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:a("adminUsers.viewDetails")||"Szczegoly",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(s),className:"p-1.5 text-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors",title:a("adminUsers.changeRole")||"Zmien role",children:e.jsx(q,{className:"w-4 h-4"})}),s.discordId!==m.discordId&&e.jsx("button",{onClick:()=>A(s),className:"p-1.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:a("common.delete"),children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"px-4",children:e.jsx(De,{currentPage:c,totalPages:X,onPageChange:h,totalItems:ee,itemsPerPage:_})})]}),M&&e.jsx($,{isOpen:M,onClose:()=>{R(!1),T(null),E(null)},title:`${(I==null?void 0:I.username)||"User"} - ${a("adminUsers.details")||"Szczegoly"}`,children:ne?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"})}):o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-dark-700/50 rounded-lg",children:[e.jsx("img",{src:o.avatar?`https://cdn.discordapp.com/avatars/${o.discordId}/${o.avatar}.png?size=64`:"https://cdn.discordapp.com/embed/avatars/0.png",alt:"",className:"w-14 h-14 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-white",children:o.username}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o.email||"-"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 font-mono",children:o.discordId})]}),e.jsx("span",{className:`ml-auto px-3 py-1 rounded-full text-xs font-semibold ${o.role==="ADMIN"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-gray-100 dark:bg-dark-600 text-gray-700 dark:text-gray-300"}`,children:o.role})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:[a("adminUsers.userLicenses")||"Licencje uzytkownika"," (",((G=o.createdLicenses)==null?void 0:G.length)||0,")"]}),((J=o.createdLicenses)==null?void 0:J.length)>0?e.jsx("div",{className:"space-y-2",children:o.createdLicenses.map(s=>{var t;return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${s.tier==="VIP"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300"}`,children:s.tier}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.isActive?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:s.isActive?"Active":"Inactive"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString("pl-PL"):"Lifetime"})]}),e.jsx("p",{className:"text-xs font-mono text-gray-500 dark:text-gray-400 mt-1 break-all",children:s.licenseKey}),((t=s.guilds)==null?void 0:t.length)>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.guilds.map(d=>e.jsx("span",{className:"text-xs px-2 py-0.5 bg-dark-600 text-gray-300 rounded",children:d.guildName||d.guildId},d.guildId))})]},s.id)})}):e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 py-2",children:a("adminUsers.noLicenses")||"Brak licencji"})]})]}):null}),b&&e.jsx(Ie,{isOpen:!!b,onClose:()=>A(null),onConfirm:ie,title:a("adminUsers.deleteConfirmTitle")||"Usun uzytkownika",message:`${a("adminUsers.deleteConfirmMessage")||"Czy na pewno chcesz usunac uzytkownika"} ${b.username}?`,confirmText:a("common.delete"),danger:!0}),Z&&e.jsx($,{isOpen:Z,onClose:()=>{w(!1),v("")},title:`Zbanuj ${l.length} uzytkownikow`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Zbanowani uzytkownicy nie beda mogli korzystac z systemu. Ta akcja jest odwracalna."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Powod bana (opcjonalnie)"}),e.jsx("input",{type:"text",value:W,onChange:s=>v(s.target.value),placeholder:"np. Naruszenie regulaminu",maxLength:255,className:"w-full px-4 py-2.5 bg-gray-50 dark:bg-dark-700 border border-gray-200 dark:border-dark-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{w(!1),v("")},className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm font-medium transition-colors",children:"Anuluj"}),e.jsxs("button",{onClick:me,disabled:U,className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50",children:[U?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(B,{className:"w-4 h-4"}),"Zbanuj ",l.length," uzytkownikow"]})]})]})})]})}export{Re as default};
